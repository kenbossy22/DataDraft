<!DOCTYPE html>
<html>
<head>
  <title>3D Scatterplot in VR</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.0/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands"></script>
</head>
<body>
  <a-scene>
    <!-- Sky -->
    <a-sky color="#000" radius="50"></a-sky>

    <!-- Axes -->
    <a-entity>
      <a-box position="5 0 0" width="10" height="0.05" depth="0.05" color="red"></a-box>
      <a-text value="Completeness Rating" position="10.5 0.2 0" rotation="0 0 0" color="red"></a-text>

      <a-box position="0 5 0" width="0.05" height="10" depth="0.05" color="green"></a-box>
      <a-text value="PtPG" position="0 10.5 0.2" rotation="0 0 0" color="green"></a-text>

      <a-box position="0 0 5" width="0.05" height="0.05" depth="10" color="blue"></a-box>
      <a-text value="Weighted Rating" position="0.2 0 10.5" rotation="0 0 0" color="blue"></a-text>
    </a-entity>

    <!-- Data Points -->
    <a-entity id="scatterplot" position="0 0 0" grab hoverable super-hands></a-entity>

    <!-- Camera -->
    <a-camera position="0 5 20" wasd-controls="enabled: true" look-controls>
      <a-cursor></a-cursor>
    </a-camera>

    <!-- Hand Controllers -->
    <a-entity hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"></a-entity>
    <a-entity hand-controls="hand: right; handModelStyle: lowPoly; color: #ccccff"></a-entity>
  </a-scene>

  <script>
    fetch('scatter_data.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
      })
      .then(data => {
        const scatterplot = document.getElementById('scatterplot');

        data.forEach(point => {
          const { 
            'Completeness Rating': x, 
            'Weighted_Rating': z, 
            'PtPG': y, 
            'Player Name': name, 
            'Games', 
            'G', 
            'A', 
            'Pts', 
            'PPP', 
            'ShotsPG', 
            'HitsPG', 
            'BlocksPG' 
          } = point;

          // Adjust the scale for better visualization
          const scaledX = x / 10;
          const scaledY = y * 5;
          const scaledZ = z / 10;

          // Create datapoint sphere
          const sphere = document.createElement('a-sphere');
          sphere.setAttribute('position', `${scaledX} ${scaledY} ${scaledZ}`);
          sphere.setAttribute('radius', 0.2);
          sphere.setAttribute('color', getColorFromMetric(y));
          sphere.setAttribute('hoverable', true); // Allows hover interactions
          scatterplot.appendChild(sphere);

          // Create tooltip for the datapoint
          const tooltip = document.createElement('a-text');
          tooltip.setAttribute('value', 
            `Player: ${name}
Completeness Rating: ${x.toFixed(1)}
Weighted Rating: ${z.toFixed(1)}
Points per Game (PtPG): ${y.toFixed(1)}
Games: ${Games}
Goals: ${G}
Assists: ${A}
Points: ${Pts}
Powerplay Points: ${PPP}
Shots per Game: ${ShotsPG}
Hits per Game: ${HitsPG}
Blocks per Game: ${BlocksPG}`
          );
          tooltip.setAttribute('position', `0 0.5 0`);
          tooltip.setAttribute('align', 'center');
          tooltip.setAttribute('scale', '0.5 0.5 0.5');
          tooltip.setAttribute('color', 'yellow');
          tooltip.setAttribute('visible', false);
          sphere.appendChild(tooltip);

          // Rotate tooltip to face the user dynamically
          sphere.addEventListener('mouseenter', () => {
            tooltip.setAttribute('visible', true);
            const camera = document.querySelector('a-camera');
            const cameraPosition = camera.object3D.position;
            const spherePosition = sphere.object3D.position;
            const direction = cameraPosition.clone().sub(spherePosition).normalize();
            const rotation = Math.atan2(direction.x, direction.z) * (180 / Math.PI);
            tooltip.setAttribute('rotation', `0 ${rotation} 0`);
          });

          sphere.addEventListener('mouseleave', () => tooltip.setAttribute('visible', false));
        });
      })
      .catch(error => {
        console.error('Error loading scatterplot data:', error);
      });

    function getColorFromMetric(ptpg) {
      if (ptpg < 0.75) return 'blue';
      if (ptpg <= 1.0) return 'yellow';
      return 'green';
    }
  </script>
</body>
</html>
