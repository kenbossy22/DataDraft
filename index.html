<!DOCTYPE html>
<html>
  <head>
    <title>3D Scatterplot in VR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- Sky -->
      <a-sky color="#000"></a-sky>

      <!-- Axes -->
      <a-entity>
        <!-- X-axis (Completeness Rating) -->
        <a-box position="5 0 0" width="10" height="0.05" depth="0.05" color="red"></a-box>
        <a-text value="Completeness Rating" position="10.5 0.2 0" rotation="0 0 0" color="red"></a-text>

        <!-- Y-axis (PtPG) -->
        <a-box position="0 5 0" width="0.05" height="10" depth="0.05" color="green"></a-box>
        <a-text value="PtPG" position="0 10.5 0.2" rotation="0 0 0" color="green"></a-text>

        <!-- Z-axis (Weighted Rating) -->
        <a-box position="0 0 5" width="0.05" height="0.05" depth="10" color="blue"></a-box>
        <a-text value="Weighted Rating" position="0.2 0 10.5" rotation="0 0 0" color="blue"></a-text>
      </a-entity>

      <!-- Data Points -->
      <a-entity id="scatterplot"></a-entity>

      <!-- Camera -->
      <a-camera position="0 5 20">
        <a-cursor></a-cursor>
      </a-camera>
    </a-scene>

    <script>
      // Color logic based on metrics
      function getColorFromMetric(metric, isPtPG = false) {
        if (isPtPG) {
          if (metric <= 0.75) return 'blue';
          else if (metric > 0.75 && metric <= 1.0) return 'yellow';
          else return 'green';
        } else {
          if (metric <= 60) return 'blue';
          else if (metric > 60 && metric <= 70) return 'yellow';
          else return 'green';
        }
      }

      // Fetch the scatterplot data
      fetch('scatter_data.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          const scatterplot = document.getElementById('scatterplot');

          data.forEach(point => {
            const { 'Completeness Rating': x, 'Weighted_Rating': z, 'PtPG': y, 'Player Name': name } = point;

            // Scale values for better VR visualization
            const scaledX = x / 5; // Adjust scaling to separate points
            const scaledY = y * 10; // Larger scaling for Y-axis
            const scaledZ = z / 5; // Adjust scaling to separate points

            // Create the data point
            const sphere = document.createElement('a-sphere');
            sphere.setAttribute('position', `${scaledX} ${scaledY} ${scaledZ}`);
            sphere.setAttribute('radius', 0.2); // Smaller data points
            sphere.setAttribute('color', getColorFromMetric(y, true));
            scatterplot.appendChild(sphere);

            // Add hoverable label
            const tooltip = document.createElement('a-text');
            tooltip.setAttribute('value', `${name}\nPtPG: ${y.toFixed(2)}`);
            tooltip.setAttribute('position', `${scaledX} ${scaledY + 0.5} ${scaledZ}`);
            tooltip.setAttribute('color', 'white');
            tooltip.setAttribute('scale', '0.5 0.5 0.5');
            scatterplot.appendChild(tooltip);
          });
        })
        .catch(error => {
          console.error('Error loading scatterplot data:', error);
        });
    </script>
  </body>
</html>
